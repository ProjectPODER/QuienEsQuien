<template name="showPersonWrapper">
  {{#with selectedPersonDoc }}
  <div class="container">
    <div class='viewWrapper'>
      <div class='datos-generales clearfix'>
        <div class="gd-col-left-wrapper col-m-12">
          {{#if name }}
            <div class="description-data-name">
              <h3><img src="../images/icons/persona-gray.svg" alt="Ícono persona" class="icon-lf icon-lf-person">{{ name }}</h3>
              <h4 class="person-type">


                {{#if gender }}
                  {{#if gender = "male" }}
                  Empresario
                  {{else}}
                  Empresaria
                  {{/if}}
                {{else}}
                Empresario(a)
                {{/if}}
              </h4>
            </div>
            <hr>
          {{/if}}
        </div>

        {{#if has_memberships }}
        <div class="col-m-12">
          <h4 class="description-data-subtitle">EMPRESAS</h4>
        </div>
        <div class="col-m-12 mb-3">
          <table class="table table-responsive">
            <thead>
              <tr>
                <th class="description-data-subname">Nombre</th>
                <th class="description-data-subname">Rol</th>
              </tr>
            </thead>
            <tbody>
              {{# each membership in memberships }}
              <tr>
                <td class="description-data-organization"><img src="../images/icons/organizacion-blue.svg" alt="Ícono persona" class="icon-lf icon-lf-organization">{{membership.sob_org}}</td>
                <td class="description-data-rol">{{membership.role}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        {{/if}}
        {{#if has_contracts }}
        <div class="col-m-12">
          <h4 class="description-data-subtitle">CONTRATOS</h4>
        </div>
        <div class="col-m-12 mb-3">
          <table class="table table-responsive">
            <thead>
              <tr>
                <th class="description-data-subname">Nombre</th>
                <th class="description-data-subname">Importe</th>
                <th class="description-data-subname">Periodo</th>
              </tr>
            </thead>
            <tbody>
              {{# each contract in contracts }}
              <tr>
                <td class="description-data-contract"><img src="../images/icons/contrato-blue.svg" alt="Ícono persona" class="icon-lf icon-lf-contract">{{contract.title}}</td>
                <td class="description-data-amount">{{contract.amount}}</td>
                <td class="description-data-date">{{contract.dates}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
        <div class="col-m-9 mb-3">
          <table class="table table-responsive">
            <thead>
              <tr>
                <th class="description-data-subname">Cantidad</th>
                <th class="description-data-subname">Importes</th>
                <th class="description-data-subname">Periodo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="description-data-contract">{{total_contract_number}}</td>
                <td class="description-data-amount">{{total_contract_amount}}</td>
                <td class="description-data-date">{{contract_periods}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-m-3 centered contract-button">
          <a href="/contracts?filter_supplier={{id}}" class="button-link">Ver todos los contratos</a>
        </div>
        {{/if}}

        <div class="col-m-12">
          <h4 class="description-data-subtitle">GRÁFICO DE RELACIONES</h4>
        </div>
      </div>

      {{#if address }}
        <div class="address clearfix">
          <h3 class="detail_header">{{__ "address" }}</h3>
          <table class="table">
            <tbody>
              {{#each arrayify address }}
                <tr>
                  <td>{{__ name }}</td>
                  <td>{{value}}</td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      {{/if}}
      {{> Memberships }}
    </div>
  </div>
  {{/with}}

  <div class="container addinfo">
    <div class="col-m-12 col-12">
      <hr>
    </div>
    <div class="col-m-12">
      <h4 class="addinfo-title ">¿Conoces más información? Puedes ayudarnos a completar este perfil.</h4>
    </div>
    <div class="col-m-8 col-8">
      <form action="" class="addinfo-form">
        <div class="form-group">
          <label>SI TIENES INFORMACIÓN PARA APORTAR A ESTA PERSONA, AGRÉGALA AQUÍ.</label>
          <textarea class="form-control" rows="6" placeholder="ESCRIBE LOS DATOS QUE DESEAS APORTAR"></textarea>
        </div>
        <div class="form-group">
          <label>FUENTE</label>
          <input class="form-control" type="text" placeholder="AGREGA LA FUENTE DE INFORMACIÓN">
        </div>
        <div class="mt-2">
          <a href="" class="button-link" target="_blank">ENVIAR</a>
        </div>
      </form>
    </div>
    <div class="col-m-4 col-4">
      <div class="addinfo-box">
        <h4>SI DESESAS FILTRAR LOS DATOS ANÓNIMAMENTE, ACCEDE A</h4>
        <img src="../images/mexicoleaks-negro.png" alt="Mexicoleaks Logo" class="addinfo-box-logo">
        <p>Una plataforma de filtración de datos anónima y segura que verifica la información proporcionada.</p>
        <div class="mt-2 mb-1">
          <a href="https://mexicoleaks.mx/enviar-para.php?r=poder" class="button-link" target="_blank">ACCEDER</a>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="PersonSubmit">
  {{#if authInProcess}}
    <p>&nbsp;</p>
  {{else}}
    {{#if is_admin}}
      {{> person_update_form
        meteormethod="Persons.methods.insert"
        formType='method'
      }}
    {{else}}
      <p id="unauthorized">No tienes permiso de ver esta página. Escribe a
        <a href="info@quienesquien.wiki">info@quienesquien.wiki</a>
        para obtener acceso.</p>
    {{/if}}
  {{/if}}
</template>

<template name="PersonHistory">
  <ul>
    <li>
      <a class="rev-link" href="/persons/{{person._id}}#draft">ultimo versión</a>.
      {{#if person.user_id }}
        actualizado por
        <i>{{ updatedBy person.user_id }}</i>.
      {{/if}}
    </li>
    {{#each revisions}}
      <li>
        actualizado por
        <i>{{ updatedBy user_id }}</i>
        <a class="rev-link" href="/persons/{{personId}}/revisions/{{revisionId}}#draft">{{ fromNow lastModified }}</a>.
      </li>
    {{/each}}
  </ul>
</template>

<template name="person_update_form">
  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    {{#autoForm collection=personsCollection
  doc=selectedPersonDoc
  id="updatePersonForm"
  type=formType
  meteormethod=meteormethod
  singleMethodArgument=true
  }}
      <!-- datos generales -->
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="general_data_heading">
          <h4 class="panel-title text-capitalize">
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#general_data_collapse" aria-expanded="true" aria-controls="general_data_collapse">
              {{__ 'general data'}}
            </a>
          </h4>
        </div>
        <div id="general_data_collapse" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="general_data_heading">
          <div class="panel-body">
            {{> afQuickField name='name'}}
            {{> afQuickField name='prefix'}}
            {{> afQuickField name='suffix'}}
            {{> afQuickField name='gender' options="allowed"}}
            {{> afQuickField name='nationality'}}
            {{> afQuickField name='date_birth'}}
            {{> afQuickField name='date_death'}}
          </div>
        </div>
      </div>
      <!-- datos generales -->
      <!-- address -->
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="address_heading">
          <h4 class="panel-title text-capitalize">
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#address_collapse" aria-expanded="true" aria-controls="address_collapse">
              {{__ "address"}}
            </a>
          </h4>
        </div>
        <div id="address_collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="address_heading">
          <div class="panel-body">
            {{> afQuickField name='address'}}
          </div>
        </div>
      </div>
      <!-- address -->
      <!-- references -->
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="references_heading">
          <h4 class="panel-title text-capitalize">
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#references_collapse" aria-expanded="true" aria-controls="references_collapse">
              {{__ "references"}}
            </a>
          </h4>
        </div>
        <div id="references_collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="references_heading">
          <div class="panel-body">
            {{> afQuickField name='references' minCount=1}}
          </div>
        </div>
      </div>
      <!-- references -->
      <button type="submit" class="btn btn-primary">{{__ "Submit"}}</button>
    {{/autoForm}}
    <!-- FIXME enable following further testing and improvements
    {{> editMemberships doc=selectedPersonDoc}}
    -->
  </div>
  <!-- id="accordion" -->
</template>
