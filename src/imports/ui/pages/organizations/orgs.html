<template name="showOrgWrapper">
  {{#if ready }}
    {{> DetailWrapper document=selectedOrganizationDoc ready=ready }}
  {{/if}}
</template>

<template name="orgView">
{{#with document }}
<div class="container">
  <div class='viewWrapper'>
    <div class='datos-generales clearfix'>
      <div class="gd-col-left-wrapper col-m-12 col-12">
      {{#if name }}
        <div class="description-data-name">
          <h3><img src="../images/icons/organizacion-gray.svg" alt="organización" class="icon-lf">{{ name }}</h3>
          <h4 class="org-type">{{#if isPublic}}Dependencia{{else}}Empresa{{/if}}</h4>
        </div>
        <hr>
      {{/if}}

      <div class="">
        <div class="col-m-6 flex mt-2">
            <div class="col-m-12">
              <h4 class="description-data-subtitle">INFORMACIÓN GENERAL</h4>
            </div>
            {{#if company.sector }}
            <div class="col-m-6">
                <p class="js-title-data">Sector</p>
                <p class="js-data-lf">{{company.sector}}</p>
            </div>
            {{/if}}
            {{#if type }}
            <div class="col-m-6">
                <p class="js-title-data">Tipo de organización</p>
                <p class="js-data-lf">{{type}}</p>
            </div>
            {{/if}}
            {{#if company.classification }}
            <div class="col-m-6">
                <p class="js-title-data">Industria</p>
                <p class="js-data-lf">{{company.classification}}</p>
            </div>
            {{/if}}
            {{#if isPublic=false }}
            <div class="col-m-6">
                <p class="js-title-data">Cotiza en bolsa</p>
                <p class="js-data-lf">{{#if company.tickers }}Si, clave: {{company.tickers}}{{else}}No{{/if}}</p>
            </div>
            {{/if}}
            {{#if company.status}}
            <div class="col-m-6">
                <p class="js-title-data">Situación</p>
                <p class="js-data-lf">{{company.status}}</p>
            </div>
            {{/if}}

            {{#if foundation_date }}
            <div class="col-m-6">
                <p class="js-title-data">Fundación</p>
                <p class="js-data-lf">{{foundation_date}}</p>
            </div>
            {{/if}}
            {{#if immediate_parent }}
            <div class="col-m-12">
                <p class="js-title-data">Organización controlante directa</p>
                <p class="js-data-lf"><a href="/orgs/{{simpleName immediate_parent}}">{{immediate_parent}}</a></p>
            </div>
            {{/if}}
            {{#if parent }}
            <div class="col-m-12">
                <p class="js-title-data">Organización controlante final</p>
                <p class="js-data-lf"><a href="/orgs/{{simpleName parent}}">{{parent}}</a></p>
            </div>
            {{/if}}

        </div>
        {{#if address}}
          <div class="col-m-6 flex mt-2">
            <div class="col-m-12">
              <h4 class="description-data-subtitle">LOCALIZACIÓN Y CONTACTO</h4>
            </div>
            <div class="col-m-12">
              <div class="if-address-org">
                <p class="js-title-data">Dirección Fiscal</p>
                <p class="mb-0">
                  {{#if address.street}}
                    <span class="js-data-lf">{{address.street}}, </span>
                  {{/if}}
                  {{#if address.postal_code}}
                    <span class="js-data-lf">C.P. {{address.postal_code}}</span>
                  {{/if}}
                </p>
                <p class="mb-0">
                  {{#if address.city}}
                    <span class="js-data-lf">{{address.city}}, </span>
                  {{/if}}
                  {{#if address.state}}
                    <span class="js-data-lf">{{address.state}}, </span>
                  {{/if}}
                  {{#if address.country}}
                    <span class="js-data-lf">{{address.country}}</span>
                  {{/if}}
                </p>
              </div>

            </div>
            <div class="col-m-12">
              {{#if address.website}}
                <p class="js-title-data">Dirección web</p>
                <a href="//{{address.website}}" target="_blank"><p class="js-data-lf js-data-link">{{address.website}}</p></a>
              {{/if}}
            </div>
            <div class="col-m-12">
            </div>
            <div class="col-m-12">
              {{#if address.phones}}
                <p class="js-title-data">Teléfono</p>
                <p class="js-data-lf">{{address.phones}}</p>
              {{/if}}
            </div>
        </div>
        {{/if}}
        <div class="col-m-12 col-12">
          <hr>
        </div>
        {{#if contract_count }}
          {{#if contracts.length = 0 }}
            Cargando gráficos
          {{else}}
            <div class="col-m-12 col-12 mt-2">
              <h4 class="description-data-subtitle">EVOLUCIÓN DE CONTRATOS</h4>
              <div id="chart">
                <svg></svg>
              </div>
            </div>
            <div class="col-m-12 col-6 mt-2">
              <h4 class="description-data-subtitle">TIPO DE CONTRATOS</h4>
              <div id="piechart">
                <svg></svg>
              </div>
            </div>
            <div class="col-m-12 col-6 mt-2">
              <h4 class="description-data-subtitle">PRESUPUESTO POR RAMO</h4>
              <div id="treemap">
              </div>
            </div>
            <div class="col-m-12 col-12 mt-2">
              <h4 class="description-data-subtitle">FLUJOS DE DINERO A PROVEEDORES</h4>
              <div id="graph-container">
              </div>
            </div>
            <div class="col-m-8 col-8">
              <hr>
            </div>
            <div class="col-m-12 col-12 mt-2">
              <h4 class="description-data-subtitle">{{#if isPublic}}PROVEEDORES PRINCIPALES{{else}}UNIDADES COMPRADORAS PRINCIPALES{{/if}}</h4>
              {{# each dependency in dependencySummary }}
              <p class="principal-suppliers"><a href="/orgs/{{simpleName dependency.name}}"><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">{{dependency.name}} ({{dependency.memberOf}})</a></p>
              {{/each}}
            </div>
            <!-- <div class="col-m-7 col-7 mt-2">
              <h4 class="description-data-subtitle">MAPA DE UNIDADES COMPRADORAS</h4>
            </div> -->
            <div class="col-m-8 col-8">
              <hr>
            </div>
          {{/if}}
        {{#if contracts.length }}
          <div class="col-m-12 col-12 mt-2">
            <h4 class="description-data-subtitle">CONTRATOS</h4>
            <table class="table table-responsive">
              <thead>
                <tr>
                  <th class="description-data-subname">Nombre</th>
                  <th class="description-data-subname">Importe</th>
                  <th class="description-data-subname">Periodo</th>
                </tr>
              </thead>
              <tbody>
                {{# each contract in contracts }}
                <tr>
                    <td class="description-data-contract">
                      <img src="../images/icons/contrato-blue.svg" alt="Ícono contrato" class="icon-lf icon-lf-contract">
                      <a href="/contracts/{{contract.ocid}}?supplier={{contract.contracts.[0].suppliers}}">{{contract.contracts.[0].title}}</a>
                    </td>
                    <td class="description-data-amount">{{ format_amount contract.contracts.[0].value.amount}} {{format_currency contract.contracts.[0].value.currency}}</td>
                    <td class="description-data-date">{{get_year contract.contracts.[0].period.startDate}}</td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
          <div class="col-m-9 mb-3">
          <p>Viendo <strong>{{contract_count}} contrato(s) en total</strong>. </p>
          <div class="col-m-3 centered contract-button">
            <a href="/contracts?{{# if public }}filter_buyer.name={{name}}{{else}}filter_contracts.0.suppliers={{simple}}{{/if}}" class="button-link">Ver todos los contratos</a>
          </div>
          <!-- <table class="table table-responsive">
            <thead>
              <tr>
                <th class="description-data-subname">Cantidad</th>
                <th class="description-data-subname">Importes</th>
                <th class="description-data-subname">Periodo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="description-data-contract">900</td>
                <td class="description-data-amount">5,793,345,245 MXN</td>
                <td class="description-data-date">Diciembre 14, 2013 - Diciembre 29, 2013</td>
              </tr>
            </tbody>
          </table> -->
        </div>
        {{/if}}
        <!-- <div class="col-m-8 col-8">
          <hr>
        </div> -->
        {{/if}}
        <!-- <div class="col-m-12 col-12 mt-2">
          <h4 class="description-data-subtitle">OTRAS DEPENDENCIAS DEL MISMO RAMO</h4>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">Banamex SAB DE CV</a></p>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">Banorte SA DE CV</a></p>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">Banco Santander Serfín</a></p>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">Manco Mercantil del Norte</a></p>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">Banco del Bajío SAB</a></p>
          <p class="other-dependency"><a><img src="../images/icons/organizacion-blue.svg" alt="organización" class="icon-lf icon-lf-organization">BanRegio SA de CV</a></p>
        </div> -->
      </div>

      </div>

    </div>

  </div>
</div>
{{/with}}
<div class="container addinfo">
    <div class="col-m-12 col-12">
      <hr>
    </div>
    <div class="col-m-12">
      <h4 class="addinfo-title ">¿Conoces más información? Puedes ayudarnos a completar este perfil.</h4>
    </div>
    <div class="col-m-8 col-8">
      <form action="" class="addinfo-form">
        <div class="form-group">
          <label>SI TIENES INFORMACIÓN PARA APORTAR A ESTA PERSONA, AGRÉGALA AQUÍ.</label>
          <textarea class="form-control" rows="6" placeholder="ESCRIBE LOS DATOS QUE DESEAS APORTAR"></textarea>
        </div>
        <div class="form-group">
          <label>FUENTE</label>
          <input class="form-control" type="text" placeholder="AGREGA LA FUENTE DE INFORMACIÓN">
        </div>
        <div class="mt-2">
          <button type="button" class="button-link" data-toggle="modal" data-target="#subscribe-popup">ENVIAR</button>
        </div>
      </form>
    </div>
    <div class="col-m-4 col-4">
      <div class="addinfo-box">
        <h4>SI DESESAS FILTRAR LOS DATOS ANÓNIMAMENTE, ACCEDE A</h4>
        <img src="../images/mexicoleaks-negro.png" alt="Mexicoleaks Logo" class="addinfo-box-logo">
        <p>Una plataforma de filtración de datos anónima y segura que verifica la información proporcionada.</p>
        <div class="mt-2 mb-1">
          <a href="https://mexicoleaks.mx/enviar-para.php?r=poder" class="button-link" target="_blank">ACCEDER</a>
        </div>
      </div>
    </div>
  </div>
  {{> popupSubscribe }}
</template>



<template name="competitors">
  <div class="competitors clearfix">
    <h3 class="detail_header">{{__ "competitors" }}</h3>
    <table class="table">
      <tbody>
  {{#each competitor in competitors }}
    <tr>
      <td>
      {{#if competitor.name }}
        <a href="/orgs/{{simpleName competitor.name}}#vista" class="link-to-org">{{competitor.name}}</a>
      {{else}}
        {{competitor.name}}
      {{/if}}
        </td>
    </tr>
  {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="hidden">

</template>

<!-- <template name="OrgSubmit">
  {{#if authInProcess}}
    <p>&nbsp;</p>
  {{else}}
    {{#if isPrivladged }}
      {{> upsertOrganisationForm
        formType='method'
        meteormethod="Orgs.methods.insert"
      }}
    {{else}}
      <p id="unauthorized">
        No tienes permiso de ver esta página. Escribe a
         <a href="info@quienesquien.wiki">info@quienesquien.wiki</a>
        para obtener acceso.
      </p>
    {{/if}}
  {{/if}}
</template> -->

<template name="upsertOrganisationForm">
<!-- <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
{{#autoForm collection=orgsCollection
  doc=selectedOrganizationDoc
  id="updateOrgForm"
  type=formType
  meteormethod=meteormethod
  singleMethodArgument=true
}} -->
<!-- general data -->
  <!-- <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="general_data_heading">
      <h4 class="panel-title text-capitalize">
        <a role="button" data-toggle="collapse" data-parent="#accordion"
          href="#general_data_collapse" aria-expanded="true"
          aria-controls="general_data_collapse">
         {{__ 'general data'}}
        </a>
      </h4>
    </div>
    <div id="general_data_collapse" class="panel-collapse collapse in"
    role="tabpanel" aria-labelledby="general_data_heading">
      <div class="panel-body">
        {{> afQuickField name='name'}}
        {{> afQuickField name='foundation_date'}}
        {{> afQuickField name='description'}}
        {{> afQuickField name='type'}}
        {{> afQuickField name='source'}}
      </div>
    </div>
  </div> -->
<!-- general data -->
<!-- address -->
  <!-- <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="address_heading">
      <h4 class="panel-title text-capitalize">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#address_collapse" aria-expanded="true" aria-controls="address_collapse">
          {{__ "address"}}
        </a>
      </h4>
    </div>
    <div id="address_collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="address_heading">
      <div class="panel-body">
{{> afQuickField name='address'}}
      </div>
    </div>
  </div> -->
<!-- address -->
<!-- corporate data -->
  <!-- <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="corporate_data_heading">
      <h4 class="panel-title text-capitalize">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#corporate_data_collapse" aria-expanded="false" aria-controls="corporate_data_collapse">
{{__ "corporate data"}}
        </a>
      </h4>
    </div>
    <div id="corporate_data_collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="corporate_data_heading">
      <div class="panel-body">


        {{> afQuickField name='company'}}
     </div>
    </div>
  </div> -->
<!-- corporate data -->
<!-- <button type="submit" class="btn btn-primary">{{__ "Submit"}}</button>
{{/autoForm}}
</div>
-->
</template>
<!--
<template name="amount_table_column">
{{right_pad amount}}
</template>

<template name="end_date_table_column">
{{moment_L end_date}}
</template>

<template name="start_date_table_column">
{{moment_L start_date}}
</template> -->
